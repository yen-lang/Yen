// ============================================
// Phase 5 Test: Standard Libraries (7 modules)
// ============================================

// 5.1 DateTime
print "=== 5.1 DateTime ===";
import 'datetime';
let now = datetime_now();
print now > 0;                        // true
let year = datetime_year(now);
print year >= 2025;                   // true
let month = datetime_month(now);
print month >= 1;                     // true
print month <= 12;                    // true
let day = datetime_day(now);
print day >= 1;                       // true
let hour = datetime_hour(now);
print hour >= 0;                      // true
let minute = datetime_minute(now);
print minute >= 0;                    // true
let second = datetime_second(now);
print second >= 0;                    // true
let weekday = datetime_weekday(now);
print weekday >= 0;                   // true
print weekday <= 6;                   // true

// datetime_add and datetime_diff
let t1 = datetime_now();
let t2 = datetime_add(t1, 60.0);
let diff = datetime_diff(t2, t1);
print diff;                           // 60

// datetime_format
let formatted = datetime_format(t1, "%Y");
print int(formatted) >= 2025;         // true

// 5.2 Testing
print "=== 5.2 Testing ===";
import 'testing';
test_reset();
test_describe("Math Tests");
test_it("addition");
test_assert_eq(1 + 1, 2);
test_it("inequality");
test_assert_neq(1, 2);
test_it("truthy");
test_assert_true(true);
test_it("falsy");
test_assert_false(false);
let summary = test_summary();
print summary["pass"];                // 4
print summary["fail"];                // 0
print summary["total"];               // 4

// 5.3 Color
print "=== 5.3 Color ===";
import 'color';
let red = color_red("error");
print str_length(red) > 5;            // true (contains ANSI codes)
let green = color_green("ok");
print str_length(green) > 2;          // true
let bold = color_bold("important");
print str_length(bold) > 9;           // true
let reset = color_reset();
print str_length(reset) > 0;          // true
let rgb = color_rgb(255, 128, 0, "orange");
print str_length(rgb) > 6;            // true

// 5.4 Set
print "=== 5.4 Set ===";
import 'set';
let s1 = set_new();
set_add(s1, 1);
set_add(s1, 2);
set_add(s1, 3);
set_add(s1, 2);                       // duplicate, shouldn't add
print set_size(s1);                   // 3
print set_contains(s1, 2);            // true
print set_contains(s1, 5);            // false

let s2 = set_from_list([3, 4, 5]);
print set_size(s2);                   // 3

let u = set_union(s1, s2);
print set_size(u);                    // 5 (1,2,3,4,5)

let inter = set_intersect(s1, s2);
print set_size(inter);                // 1 (just 3)

let d = set_difference(s1, s2);
print set_size(d);                    // 2 (1,2)

let sym = set_symmetric_diff(s1, s2);
print set_size(sym);                  // 4 (1,2,4,5)

let sub = set_from_list([1, 2]);
print set_is_subset(sub, s1);         // true
print set_is_subset(s1, sub);         // false

set_remove(s1, 2);
print set_size(s1);                   // 2
print set_contains(s1, 2);            // false

// 5.5 Path
print "=== 5.5 Path ===";
import 'path';
let joined = path_join("/usr", "local", "bin");
print joined;                         // /usr/local/bin
let dir = path_dirname("/usr/local/bin/yen");
print dir;                            // /usr/local/bin
let base = path_basename("/usr/local/bin/yen");
print base;                           // yen
let ext = path_extension("/home/user/file.txt");
print ext;                            // .txt
let stem = path_stem("/home/user/file.txt");
print stem;                           // file
print path_is_absolute("/usr/bin");   // true
print path_is_absolute("relative");   // false

// 5.6 CSV
print "=== 5.6 CSV ===";
import 'csv';
let csv_data = "name,age,city\nAlice,30,NYC\nBob,25,LA";
let rows = csv_parse(csv_data);
print list_length(rows);              // 3
print rows[0][0];                     // name
print rows[1][0];                     // Alice
print rows[1][1];                     // 30
print rows[2][2];                     // LA

let maps = csv_parse_header(csv_data);
print list_length(maps);              // 2
print maps[0]["name"];                // Alice
print maps[0]["age"];                 // 30
print maps[1]["city"];                // LA

// csv_stringify
let data = [["x", "y"], ["1", "2"], ["3", "4"]];
let csv_str = csv_stringify(data);
print str_contains(csv_str, "x,y");   // true
print str_contains(csv_str, "1,2");   // true

// 5.7 Event
print "=== 5.7 Event ===";
import 'event';
let emitter = event_new();
print event_listeners(emitter, "click"); // 0

// Register a callback (we'll use a lambda)
let handler = |data| data;
event_on(emitter, "click", handler);
print event_listeners(emitter, "click"); // 1

// Register another
event_on(emitter, "click", |d| d);
print event_listeners(emitter, "click"); // 2

// Emit returns list of [callback, data] pairs
let results = event_emit(emitter, "click", "payload");
print list_length(results);              // 2

// Turn off
event_off(emitter, "click");
print event_listeners(emitter, "click"); // 0

print "=== All Phase 5 Tests Complete ===";
